import{r as p,u as U,j as e,H as P,L as v}from"./app-DU_Uqt_7.js";import{B as c}from"./index-C4Wi5Few.js";import{C as b,a as N,b as w,c as k,d as F}from"./card-Cv2gufsc.js";import{D as L,a as W,b as B,c as T}from"./dialog-CW-tC62Q.js";import{I as _}from"./input-CN5tow4u.js";import{L as o}from"./label-6VXoPsPR.js";import{S as q,a as H,b as R,c as $,d as m}from"./select-BLU_jnua.js";import{T as z}from"./textarea-BfHLypiN.js";import{a as d,A as E}from"./app-layout-Dqrvh0ER.js";import{A as V}from"./arrow-left-BLUXxQID.js";import{Z as y}from"./zoom-in-BzamHZ3U.js";import{U as Z}from"./upload-B1ucdeWD.js";/* empty css            */import"./index-CbIKs6W5.js";import"./index-DXyGKaGY.js";import"./index-BufbPJzO.js";import"./index-B-oI3T1w.js";import"./index-M91RncAE.js";import"./index-BzYF3OUJ.js";import"./check-u15s6IOz.js";import"./index-CxakdeFI.js";import"./users-DiQ_qV7b.js";import"./briefcase-CIZ3dIis.js";function pe({assignedTask:s}){const C=[{title:"Assigned Tasks",href:d.assignedTasks.index().url},{title:"Update Task",href:d.assignedTasks.edit({assigned_task:s.id}).url}],[a,S]=p.useState(s.image_before||null),[r,D]=p.useState(s.image_after||null),[l,h]=p.useState(null),{data:f,setData:x,post:I,processing:j,errors:i}=U({status:s.status||"pending",feedback:s.feedback||"",image_before:null,image_after:null,_method:"PUT"}),g=(t,u)=>{if(u){const n=new FileReader;n.onloadend=()=>{t==="image_before"?S(n.result):D(n.result)},n.readAsDataURL(u),x(t,u)}},A=t=>{t.preventDefault(),I(d.assignedTasks.update({assigned_task:s.id}).url,{forceFormData:!0})};return e.jsxs(E,{breadcrumbs:C,children:[e.jsx(P,{title:"Update Assigned Task"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(v,{href:d.assignedTasks.index().url,children:e.jsx(c,{variant:"outline",size:"icon",children:e.jsx(V,{className:"h-4 w-4"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Update Task Progress"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Update status and provide feedback"})]})]}),s.task?.service_request&&e.jsxs(b,{children:[e.jsx(N,{children:e.jsx(w,{children:"Service Request Details"})}),e.jsxs(k,{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"text-sm font-medium",children:["Client:"," "]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:s.task.service_request.name})]}),e.jsxs("div",{children:[e.jsxs("span",{className:"text-sm font-medium",children:["Service:"," "]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:s.task.service_request.service})]}),e.jsxs("div",{children:[e.jsxs("span",{className:"text-sm font-medium",children:["Description:"," "]}),e.jsx("p",{className:"text-sm whitespace-pre-wrap text-muted-foreground",children:s.task.service_request.description})]}),s.task.scheduled_date&&e.jsxs("div",{children:[e.jsxs("span",{className:"text-sm font-medium",children:["Scheduled:"," "]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:new Date(s.task.scheduled_date).toLocaleDateString()})]})]})]}),e.jsxs(b,{children:[e.jsxs(N,{children:[e.jsx(w,{children:"Task Progress"}),e.jsx(F,{children:"Update the task status and provide feedback"})]}),e.jsx(k,{children:e.jsxs("form",{onSubmit:A,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"status",children:"Status *"}),e.jsxs(q,{value:f.status,onValueChange:t=>x("status",t),children:[e.jsx(H,{children:e.jsx(R,{})}),e.jsxs($,{children:[e.jsx(m,{value:"pending",children:"Pending"}),e.jsx(m,{value:"in_progress",children:"In Progress"}),e.jsx(m,{value:"completed",children:"Completed"}),e.jsx(m,{value:"cancelled",children:"Cancelled"})]})]}),i.status&&e.jsx("p",{className:"text-sm text-destructive",children:i.status})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"feedback",children:"Feedback"}),e.jsx(z,{id:"feedback",placeholder:"Describe the work performed, issues encountered, or any notes...",value:f.feedback,onChange:t=>x("feedback",t.target.value),rows:6}),i.feedback&&e.jsx("p",{className:"text-sm text-destructive",children:i.feedback})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"image_before",children:"Before Image"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(_,{id:"image_before",type:"file",accept:"image/*",onChange:t=>g("image_before",t.target.files?.[0]||null),className:"cursor-pointer"}),a&&e.jsx("div",{className:"group relative",children:e.jsxs("div",{className:"relative h-20 w-20 overflow-hidden rounded-md border",children:[e.jsx("img",{src:a.startsWith("blob:")||a.startsWith("data:")?a:`/storage/${a}`,alt:"Before preview",className:"h-full w-full rounded-md object-cover"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50 opacity-0 transition-opacity group-hover:opacity-100",children:e.jsx(c,{type:"button",variant:"ghost",size:"icon",className:"text-white hover:bg-white/20 hover:text-white",onClick:()=>h({url:a.startsWith("blob:")||a.startsWith("data:")?a:`/storage/${a}`,title:"Before Image"}),children:e.jsx(y,{className:"h-4 w-4"})})})]})})]}),i.image_before&&e.jsx("p",{className:"text-sm text-destructive",children:i.image_before})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"image_after",children:"After Image"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(_,{id:"image_after",type:"file",accept:"image/*",onChange:t=>g("image_after",t.target.files?.[0]||null),className:"cursor-pointer"}),r&&e.jsx("div",{className:"group relative",children:e.jsxs("div",{className:"relative h-20 w-20 overflow-hidden rounded-md border",children:[e.jsx("img",{src:r.startsWith("blob:")||r.startsWith("data:")?r:`/storage/${r}`,alt:"After preview",className:"h-full w-full rounded-md object-cover"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50 opacity-0 transition-opacity group-hover:opacity-100",children:e.jsx(c,{type:"button",variant:"ghost",size:"icon",className:"text-white hover:bg-white/20 hover:text-white",onClick:()=>h({url:r.startsWith("blob:")||r.startsWith("data:")?r:`/storage/${r}`,title:"After Image"}),children:e.jsx(y,{className:"h-4 w-4"})})})]})})]}),i.image_after&&e.jsx("p",{className:"text-sm text-destructive",children:i.image_after})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4",children:[e.jsx(v,{href:d.assignedTasks.index().url,children:e.jsx(c,{variant:"outline",type:"button",children:"Cancel"})}),e.jsxs(c,{type:"submit",disabled:j,children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),j?"Updating...":"Update Task"]})]})]})})]})]}),e.jsx(L,{open:!!l,onOpenChange:()=>h(null),children:e.jsxs(W,{className:"max-w-4xl",children:[e.jsx(B,{children:e.jsx(T,{children:l?.title})}),e.jsx("div",{className:"relative w-full",children:l&&e.jsx("img",{src:l.url,alt:l.title,className:"h-auto max-h-[80vh] w-full rounded-md object-contain"})})]})})]})}export{pe as default};
